"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5162],{5998:function(w,E,t){t.d(E,{Z:function(){return h}});var e=t(32735),s=t(70958);function i(){return e.createElement(s.Z.Root,null,e.createElement(s.Z.Headers,null),e.createElement(s.Z.Body,null))}var h=i},70958:function(w,E,t){var e=t(32735),s=t(60216),i=t.n(s),h=t(92802),S=t(67879),te=t(8471),ne=t(29397),m=t(87933),D=t(28847),W=t(23866),ae=t(31121),z=t(35197),B=t(38837),se=t(3685),f=t(49372),q=t(40801),re=t(8284),H=t(82884),G=t(70166);const R=r=>r.reduce((o,d)=>{const y=d.split(".")[0];return o[y]||(o[y]=[]),o[y].push(d),o},{}),X=(0,te.ZP)(ne.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:r})=>r.colors.neutral100};
  }

  thead th span {
    color: ${({theme:r})=>r.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:r})=>r.spaces[3]};
    padding-block-end: ${({theme:r})=>r.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    // Add padding to the start of the first column to avoid the checkbox appearing
    // too close to the edge of the table
    padding-inline-start: ${({theme:r})=>r.spaces[2]};
  }
`,T=r=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return r&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},oe=r=>{const o=["entry.create","entry.update","entry.delete"];return r&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},Q=e.createContext(),ee=({children:r})=>{const{formatMessage:o}=(0,S.Z)(),{collectionTypes:d,isLoading:y}=(0,G.G)(),C=e.useMemo(()=>d.some(k=>k.options.draftAndPublish===!0),[d]),Z=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(Q.Provider,{value:{isDraftAndPublish:C}},e.createElement(m.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(D.Q,{"aria-hidden":!0},Z),y&&e.createElement(W.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(X,{"aria-label":Z},r)))};ee.propTypes={children:i().oneOfType([i().arrayOf(i().node),i().node]).isRequired};const Y=({getHeaders:r=T})=>{const{isDraftAndPublish:o}=e.useContext(Q),{formatMessage:d}=(0,S.Z)(),y=r(o);return e.createElement(ae.S,null,e.createElement(z.Z,null,e.createElement(B.g,null,e.createElement(se.T,null,d({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),y.map(C=>["app.utils.publish","app.utils.unpublish"].includes(C.id)?e.createElement(B.g,{key:C.id,title:d({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},d(C))):e.createElement(B.g,{key:C.id},e.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},d(C))))))};Y.defaultProps={getHeaders:T},Y.propTypes={getHeaders:i().func};const J=({providedEvents:r})=>{const{isDraftAndPublish:o}=e.useContext(Q),d=r||oe(o),{values:y,handleChange:C}=(0,h.u6)(),Z="events",k=y.events,j=[],F=R(k),b=({target:{name:v,value:g}})=>{let P=new Set(k);g?P.add(v):P.delete(v),C({target:{name:Z,value:Array.from(P)}})},U=({target:{name:v,value:g}})=>{let P=new Set(k);g?d[v].forEach(x=>{j.includes(x)||P.add(x)}):d[v].forEach(x=>P.delete(x)),C({target:{name:Z,value:Array.from(P)}})};return e.createElement(q.X,null,Object.entries(d).map(([v,g])=>e.createElement(V,{disabledEvents:j,key:v,name:v,events:g,inputValue:F[v],handleSelect:b,handleSelectAll:U})))};J.defaultProps={providedEvents:null},J.propTypes={providedEvents:i().object};const le=r=>r.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),V=({disabledEvents:r,name:o,events:d,inputValue:y,handleSelect:C,handleSelectAll:Z})=>{const{formatMessage:k}=(0,S.Z)(),j=d.filter(g=>!r.includes(g)),F=y.length>0,b=y.length===j.length,U=({target:{name:g}})=>{Z({target:{name:g,value:!b}})},v=5;return e.createElement(z.Z,null,e.createElement(B.f,null,e.createElement(re.X,{indeterminate:F&&!b,"aria-label":k({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:U,value:b},le(o))),d.map(g=>e.createElement(B.f,{key:g},e.createElement(H.C,{disabled:r.includes(g),"aria-label":g,name:g,value:y.includes(g),onValueChange:P=>C({target:{name:g,value:P}})}))),d.length<v&&e.createElement(B.f,{colSpan:`${v-d.length}`}))};V.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},V.propTypes={disabledEvents:i().array,events:i().array,inputValue:i().array,handleSelect:i().func,handleSelectAll:i().func,name:i().string.isRequired},E.Z={Root:ee,Headers:Y,Body:J,EventRow:V}},82167:function(w,E,t){t.d(E,{Z:function(){return fe}});var e=t(32735),s=t(69262),i=t(27649),h=t(20108),S=t(53038),te=t(70166),ne=t(60216),m=t.n(ne),D=t(92802),W=t(67879),ae=t(2438),z=t(66456),B=t(29439),se=t(82055),f=t(87933),q=t(41415),re=t(17e3),H=t(72850),G=t(15335),R=t(5803),X=t(10369),T=t(24346);const oe=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Q=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,ee=({formatMessage:n})=>T.Ry().shape({name:T.Z_().required(n({id:"Settings.webhooks.validation.name",defaultMessage:"Name is required"})).matches(oe,s.I0.regex),url:T.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Q,n({id:s.I0.regex,defaultMessage:"The value does not match the regex"})),headers:T.Vo(a=>{let l=T.IX();if(a.length===1){const{key:u,value:p}=a[0];if(!u&&!p)return l}return l.of(T.Ry().shape({key:T.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:T.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:T.IX()});var Y=t(19406),J=t(28847),le=t(7563),V=t(21428),r=t(90333);const o=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],d=({name:n,onChange:a,value:l,...u})=>{const{values:{headers:p}}=(0,D.u6)(),[L,c]=(0,e.useState)(o);(0,e.useEffect)(()=>{c(o.filter(M=>!p?.some(K=>K.key!==l&&K.key===M)))},[p,l]);const O=M=>{a({target:{name:n,value:M}})},_=M=>{c(K=>[...K,M]),O(M)};return e.createElement(V.XU,{...u,onClear:()=>O(""),onChange:O,onCreateOption:_,placeholder:"",value:l},L.map(M=>e.createElement(r.O,{value:M,key:M},M)))};d.defaultProps={value:void 0},d.propTypes={name:m().string.isRequired,onChange:m().func.isRequired,value:m().string};var y=d,Z=()=>{const{formatMessage:n}=(0,W.Z)(),{values:a,errors:l}=(0,D.u6)();return e.createElement(f.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(J.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(H.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(D.F2,{validateOnChange:!1,name:"headers",render:({push:u,remove:p})=>e.createElement(G.r,{gap:4},a.headers.map((L,c)=>e.createElement(e.Fragment,{key:`${c}.${L.key}`},e.createElement(R.P,{col:6},e.createElement(D.gN,{as:y,name:`headers.${c}.key`,"aria-label":`row ${c+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:l.headers?.[c]?.key&&l.headers[c].key})),e.createElement(R.P,{col:6},e.createElement(f.k,{alignItems:"flex-end"},e.createElement(H.x,{style:{flex:1}},e.createElement(D.gN,{as:X.o,name:`headers.${c}.value`,"aria-label":`row ${c+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:l.headers?.[c]?.value&&l.headers[c].value})),e.createElement(f.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:l.headers?.[c]?.value?0:5},e.createElement(s.fG,{disabled:a.headers.length===1,onClick:()=>p(c),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:c+1})})))))),e.createElement(R.P,{col:12},e.createElement(le.A,{type:"button",onClick:()=>{u({key:"",value:""})},startIcon:e.createElement(Y.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))},k=t(8471),j=t(27169),F=t(35331),b=t(49372);const U=k.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),v=({isPending:n,statusCode:a})=>{const{formatMessage:l}=(0,W.Z)();return n?e.createElement(f.k,{gap:2,alignItems:"center"},e.createElement(U,{as:j.Z}),e.createElement(b.Z,null,l({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(f.k,{gap:2,alignItems:"center"},e.createElement(U,{as:z.Z,color:"success700"}),e.createElement(b.Z,null,l({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(f.k,{gap:2,alignItems:"center"},e.createElement(U,{as:F.Z,color:"danger700"}),e.createElement(b.Z,null,l({id:"Settings.error",defaultMessage:"error"})," ",a)):null};v.propTypes={isPending:m().bool.isRequired,statusCode:m().number},v.defaultProps={statusCode:void 0};const g=({statusCode:n,message:a})=>{const{formatMessage:l}=(0,W.Z)();return n>=200&&n<300?e.createElement(f.k,{justifyContent:"flex-end"},e.createElement(b.Z,{textColor:"neutral600",ellipsis:!0},l({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(f.k,{justifyContent:"flex-end"},e.createElement(f.k,{maxWidth:(0,s.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(b.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};g.propTypes={statusCode:m().number,message:m().string},g.defaultProps={statusCode:void 0,message:void 0};const P=({onCancel:n})=>{const{formatMessage:a}=(0,W.Z)();return e.createElement(f.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(f.k,{gap:2,alignItems:"center"},e.createElement(b.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(U,{as:F.Z,color:"neutral400"}))))};P.propTypes={onCancel:m().func.isRequired};const x=({isPending:n,onCancel:a,response:l})=>{const{statusCode:u,message:p}=l,{formatMessage:L}=(0,W.Z)();return e.createElement(H.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(G.r,{gap:4,style:{alignItems:"center"}},e.createElement(R.P,{col:3},e.createElement(b.Z,null,L({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(R.P,{col:3},e.createElement(v,{isPending:n,statusCode:u})),e.createElement(R.P,{col:6},n?e.createElement(P,{onCancel:a}):e.createElement(g,{statusCode:u,message:p}))))};x.defaultProps={isPending:!1,onCancel(){},response:{}},x.propTypes={isPending:m().bool,onCancel:m().func,response:m().object};var me=x;const Ee=(()=>window&&window.strapi&&window.strapi.isEE?t(10635).Z:t(5998).Z)(),ie=n=>{let{handleSubmit:a,triggerWebhook:l,isCreating:u,isTriggering:p,triggerResponse:L,data:c}=n;const{formatMessage:O}=(0,W.Z)(),[_,M]=(0,e.useState)(!1),K=N=>Object.keys(N).length?Object.entries(N).map(de=>{let[ce,ue]=de;return{key:ce,value:ue}}):[{key:"",value:""}],A=(0,D.TA)({initialValues:{name:c?.name||"",url:c?.url||"",headers:K(c?.headers||{}),events:c?.events||[]},onSubmit:a,validationSchema:ee({formatMessage:O}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(D.Hy,{value:A},e.createElement(s.l0,{onSubmit:A.handleSubmit},e.createElement(se.T,{primaryAction:e.createElement(f.k,{gap:2},e.createElement(q.z,{onClick:()=>{l(),M(!0)},variant:"tertiary",startIcon:e.createElement(ae.Z,null),disabled:u||p,size:"L"},O({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(q.z,{startIcon:e.createElement(z.Z,null),type:"submit",size:"L",disabled:!A.dirty,loading:A.isSubmitting},O({id:"global.save",defaultMessage:"Save"}))),title:u?O({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):c?.name,navigationAction:e.createElement(s.rU,{startIcon:e.createElement(B.Z,null),to:"/settings/webhooks"},O({id:"global.back",defaultMessage:"Back"}))}),e.createElement(re.D,null,e.createElement(f.k,{direction:"column",alignItems:"stretch",gap:4},_&&e.createElement(me,{isPending:p,response:L,onCancel:()=>M(!1)}),e.createElement(H.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(f.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(G.r,{gap:6},e.createElement(R.P,{col:6},e.createElement(D.gN,{as:X.o,name:"name",error:A?.errors?.name&&A.errors.name,label:O({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(R.P,{col:12},e.createElement(D.gN,{as:X.o,name:"url",error:A?.errors?.url&&A.errors.url,label:O({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(Z,null),e.createElement(Ee,null)))))))};ie.propTypes={data:m().object,handleSubmit:m().func.isRequired,triggerWebhook:m().func.isRequired,isCreating:m().bool.isRequired,isTriggering:m().bool.isRequired,triggerResponse:m().object},ie.defaultProps={data:void 0,triggerResponse:void 0};var he=ie;const ge=n=>({...n,headers:n.headers.reduce((a,{key:l,value:u})=>(l!==""&&(a[l]=u),a),{})});var fe=()=>{const{params:{id:n}}=(0,S.$B)("/settings/webhooks/:id"),a=n==="create",{replace:l}=(0,S.k6)(),u=(0,s.lm)(),{formatAPIError:p}=(0,s.So)(),L=(0,h.useQueryClient)(),{isLoading:c}=(0,te.G)(),{put:O,get:_,post:M}=(0,s.kY)(),{isLoading:K,data:A,error:N}=(0,h.useQuery)(["webhooks",n],async()=>{const{data:{data:I}}=await _(`/admin/webhooks/${n}`);return I},{enabled:!a});e.useEffect(()=>{N&&u({type:"warning",message:p(N)})},[N,u,p]);const{isLoading:de,data:ce,isIdle:ue,mutate:pe}=(0,h.useMutation)(()=>M(`/admin/webhooks/${n}/trigger`)),ve=()=>pe(null,{onError(I){u({type:"warning",message:p(I)})}}),Me=(0,h.useMutation)(I=>M("/admin/webhooks",I)),ye=(0,h.useMutation)(({id:I,body:$})=>O(`/admin/webhooks/${I}`,$)),Ce=async I=>{if(a){Me.mutate(ge(I),{onSuccess({data:$}){u({type:"success",message:{id:"Settings.webhooks.created"}}),l(`/settings/webhooks/${$.data.id}`)},onError($){u({type:"warning",message:p($)})}});return}ye.mutate({id:n,body:ge(I)},{onSuccess(){L.invalidateQueries(["webhooks",n]),u({type:"success",message:{id:"notification.form.success.fields"}})},onError($){u({type:"warning",message:p($)})}})};return K||c?e.createElement(s.dO,null):e.createElement(i.o,null,e.createElement(s.SL,{name:"Webhooks"}),e.createElement(he,{data:A,handleSubmit:Ce,triggerWebhook:ve,isCreating:a,isTriggering:de,isTriggerIdle:ue,triggerResponse:ce?.data.data}))}},33238:function(w,E,t){t.r(E);var e=t(32735),s=t(69262),i=t(83983),h=t(82167);const S=()=>e.createElement(s.O4,{permissions:i.Z.settings.webhooks.create},e.createElement(h.Z,null));E.default=S},59021:function(w,E,t){t.r(E);var e=t(32735),s=t(69262),i=t(83983),h=t(82167);const S=()=>e.createElement(s.O4,{permissions:i.Z.settings.webhooks.update},e.createElement(h.Z,null));E.default=S},10635:function(w,E,t){t.d(E,{Z:function(){return h}});var e=t(32735),s=t(70958);function i(){return e.createElement(s.Z.Root,null,e.createElement(s.Z.Headers,null),e.createElement(s.Z.Body,null))}var h=i},90333:function(w,E,t){t.d(E,{O:function(){return s}});var e=t(21428);const s=e.Wx},29439:function(w,E,t){t.d(E,{Z:function(){return i}});var e=t(74512);const s=h=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...h,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),i=s}}]);
