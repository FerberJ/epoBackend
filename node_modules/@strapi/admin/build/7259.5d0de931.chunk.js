"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[7259],{30493:function(k,y,e){e.d(y,{Z:function(){return M}});var t=e(32735),p=e(67879),n=e(60216),s=e.n(n),T=e(69262),a=e(66456),i=e(29439),c=e(82055),d=e(87933),m=e(41415),o=e(44647),E=e(32308);const f=({onRegenerate:R,idToRegenerate:r,backUrl:L,onError:x})=>{const{formatMessage:K}=(0,p.Z)(),[U,S]=(0,t.useState)(!1),{regenerateData:Z,isLoadingConfirmation:I}=(0,E.rW)(L,r,R,x),B=async()=>{Z(),S(!1)};return t.createElement(t.Fragment,null,t.createElement(m.z,{startIcon:t.createElement(o.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>S(!0),name:"regenerate"},K({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(T.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(o.Z,null),isConfirmButtonLoading:I,isOpen:U,onToggleDialog:()=>S(!1),onConfirm:B,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};f.defaultProps={onRegenerate(){},onError:void 0},f.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};var u=f;const l=({title:R,token:r,setToken:L,canEditInputs:x,canRegenerate:K,isSubmitting:U,backUrl:S,regenerateUrl:Z,onErrorRegenerate:I})=>{const{formatMessage:B}=(0,p.Z)(),$=j=>{L({...r,accessKey:j})};return t.createElement(c.T,{title:r?.name||B(R),primaryAction:x?t.createElement(d.k,{gap:2},K&&r?.id&&t.createElement(u,{backUrl:Z,onRegenerate:$,idToRegenerate:r?.id,onError:I}),t.createElement(m.z,{disabled:U,loading:U,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},B({id:"global.save",defaultMessage:"Save"}))):K&&r?.id&&t.createElement(u,{onRegenerate:$,idToRegenerate:r?.id,backUrl:Z}),navigationAction:t.createElement(T.rU,{startIcon:t.createElement(i.Z,null),to:S},B({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};l.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},l.defaultProps={token:void 0,onErrorRegenerate:void 0};var M=l},4321:function(k,y,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(68465),a=e(84967),i=e(49372),c=e(37944);const d=({token:m,errors:o,values:E,onChange:f,isCreating:u})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(t.Fragment,null,t.createElement(T.P,{name:"lifespan",label:l({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:E.lifespan!==null?E.lifespan:"0",error:o.lifespan?l(o.lifespan?.id?o.lifespan:{id:o.lifespan,defaultMessage:o.lifespan}):null,onChange:M=>{f({target:{name:"lifespan",value:M}})},required:!0,disabled:!u,placeholder:"Select"},t.createElement(a.W,{value:"604800000"},l({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(a.W,{value:"2592000000"},l({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(a.W,{value:"7776000000"},l({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(a.W,{value:"0"},l({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(i.Z,{variant:"pi",textColor:"neutral600"},!u&&`${l({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,c.IX)(m?.createdAt,parseInt(E.lifespan,10))}`))};d.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},d.defaultProps={errors:{},token:{}},y.Z=d},93682:function(k,y,e){var t=e(32735),p=e(67879),n=e(69262),s=e(50563),T=e(47765),a=e(11631),i=e(60216),c=e.n(i);const d=({token:m,tokenType:o})=>{const{formatMessage:E}=(0,p.Z)(),f=(0,n.lm)(),{trackUsage:u}=(0,n.rS)(),{copy:l}=(0,n.VP)(),M=R=>async()=>{await l(R)&&(u.current("didCopyTokenKey",{tokenType:o}),f({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(n.Y_,{endAction:m&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(s.h,{label:E({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:M(m),noBorder:!0,icon:t.createElement(T.Z,null),style:{padding:0,height:"1rem"}})),title:m||E({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:E(m?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};d.defaultProps={token:null},d.propTypes={token:c().string,tokenType:c().string.isRequired},y.Z=d},42789:function(k,y,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(33475);const a=({errors:i,values:c,onChange:d,canEditInputs:m})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(T.g,{label:o({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:i.description?o(i.description?.id?i.description:{id:i.description,defaultMessage:i.description}):null,onChange:d,disabled:!m},c.description)};a.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},a.defaultProps={errors:{}},y.Z=a},8377:function(k,y,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(10369);const a=({errors:i,values:c,onChange:d,canEditInputs:m})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(T.o,{name:"name",error:i.name?o(i.name?.id?i.name:{id:i.name,defaultMessage:i.name}):null,label:o({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:d,value:c.name,disabled:!m,required:!0})};a.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},a.defaultProps={errors:{}},y.Z=a},49638:function(k,y,e){var t=e(32735),p=e(60216),n=e.n(p),s=e(67879),T=e(68465),a=e(84967);const i=({name:c,errors:d,values:m,onChange:o,canEditInputs:E,options:f,label:u})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(T.P,{name:c,label:l({id:u.id,defaultMessage:u.defaultMessage}),value:m&&m[c],error:d[c]?l(d[c]?.id?d[c]:{id:d[c],defaultMessage:d[c]}):null,onChange:o,placeholder:"Select",required:!0,disabled:!E},f&&f.map(({value:M,label:R})=>t.createElement(a.W,{key:M,value:M},l(R))))};i.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},i.defaultProps={name:"type",errors:{},options:[]},y.Z=i},68774:function(k,y,e){e.d(y,{Z:function(){return t},f:function(){return p}});const t="api-token",p="transfer-token"},37944:function(k,y,e){e.d(y,{IX:function(){return T},fK:function(){return d},mk:function(){return o}});var t=e(14723),p=e(85544),n=e(76698),T=(E,f,u="en")=>{if(f&&typeof f=="number"){const l=f/24/60/60/1e3;return(0,t.Z)((0,p.Z)(new Date(E),l),"PPP",{locale:n[u]})}return"Unlimited"},a=e(24346),i=e(69262),d=a.Ry().shape({name:a.Z_(i.I0.string).max(100).required(i.I0.required),type:a.Z_(i.I0.string).oneOf(["read-only","full-access","custom"]).required(i.I0.required),description:a.Z_().nullable(),lifespan:a.Rx().integer().min(0).nullable().defined(i.I0.required)}),o=E=>{const f={allActionsIds:[],permissions:[]};return f.permissions=Object.keys(E).map(u=>({apiId:u,label:u.split("::")[1],controllers:Object.keys(E[u].controllers).map(l=>({controller:l,actions:E[u].controllers[l].map(M=>{const R=`${u}.${l}.${M}`;return u.includes("api::")&&f.allActionsIds.push(R),{action:M,actionId:R}}).flat()})).flat()})),f}},37259:function(k,y,e){e.d(y,{Z:function(){return ne}});var t=e(32735),p=e(67879),n=e(92802),s=e(53038),T=e(20108),a=e(69262),i=e(27649),c=e(17e3),d=e(87933),m=e(8997),o=e(24346),f=o.Ry().shape({name:o.Z_(a.I0.string).max(100).required(a.I0.required),description:o.Z_().nullable(),lifespan:o.Rx().integer().min(0).nullable().defined(a.I0.required),permissions:o.Z_(a.I0.string).required(a.I0.required)}),u=e(82055),l=e(41415),M=e(66456),R=e(60216),r=e.n(R);const L=({transferTokenName:D})=>{const{formatMessage:h}=(0,p.Z)();return(0,a.go)(),t.createElement(i.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"Transfer Tokens"}),t.createElement(u.T,{primaryAction:t.createElement(l.z,{disabled:!0,startIcon:t.createElement(M.Z,null),type:"button",size:"L"},h({id:"global.save",defaultMessage:"Save"})),title:D||h({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(c.D,null,t.createElement(a.dO,null)))};L.defaultProps={transferTokenName:null},L.propTypes={transferTokenName:r().string};var x=L,K=e(83983),U=e(72850),S=e(49372),Z=e(15335),I=e(5803),B=e(4321),$=e(8377),j=e(42789),J=e(49638);const G=({errors:D,onChange:h,canEditInputs:W,isCreating:O,values:A,transferToken:v})=>{const{formatMessage:N}=(0,p.Z)(),Q=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(U.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(d.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(S.Z,{variant:"delta",as:"h2"},N({id:"global.details",defaultMessage:"Details"})),t.createElement(Z.r,{gap:5},t.createElement(I.P,{key:"name",col:6,xs:12},t.createElement($.Z,{errors:D,values:A,canEditInputs:W,onChange:h})),t.createElement(I.P,{key:"description",col:6,xs:12},t.createElement(j.Z,{errors:D,values:A,canEditInputs:W,onChange:h})),t.createElement(I.P,{key:"lifespan",col:6,xs:12},t.createElement(B.Z,{isCreating:O,errors:D,values:A,onChange:h,token:v})),t.createElement(I.P,{key:"permissions",col:6,xs:12},t.createElement(J.Z,{name:"permissions",values:A,errors:D,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:F=>{h({target:{name:"permissions",value:F}})},options:Q,canEditInputs:W})))))};G.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},G.defaultProps={errors:{},transferToken:{}};var q=G,w=e(93682),ee=e(30493),z=e(68774);const te="Name already taken";var ne=()=>{(0,a.go)();const{formatMessage:D}=(0,p.Z)(),{lockApp:h,unlockApp:W}=(0,a.o1)(),O=(0,a.lm)(),A=(0,s.k6)(),[v,N]=(0,t.useState)(A.location.state?.transferToken.accessKey?{...A.location.state.transferToken}:null),{trackUsage:Q}=(0,a.rS)(),F=(0,t.useRef)(Q),{setCurrentStep:se}=(0,a.c1)(),{allowedActions:{canCreate:ae,canUpdate:re,canRegenerate:ie}}=(0,a.ss)(K.Z.settings["transfer-tokens"]),{params:{id:Y}}=(0,s.$B)("/settings/transfer-tokens/:id"),{get:oe,post:le,put:de}=(0,a.kY)(),P=Y==="create",{formatAPIError:_}=(0,a.So)();(0,t.useEffect)(()=>{F.current(P?"didAddTokenFromList":"didEditTokenFromList",{tokenType:z.f})},[P]);const{status:ce}=(0,T.useQuery)(["transfer-token",Y],async()=>{const{data:{data:g}}=await oe(`/admin/transfer/tokens/${Y}`);return N({...g}),g},{enabled:!P&&!v,onError(g){g.response.data.error.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:_(g)})}}),ue=async(g,V)=>{F.current(P?"willCreateToken":"willEditToken",{tokenType:z.f}),h();const X=g.lifespan&&parseInt(g.lifespan,10)&&g.lifespan!=="0"?parseInt(g.lifespan,10):null,H=g.permissions.split("-");try{const{data:{data:C}}=P?await le("/admin/transfer/tokens",{...g,lifespan:X,permissions:H}):await de(`/admin/transfer/tokens/${Y}`,{name:g.name,description:g.description,permissions:H});W(),P&&(A.replace(`/settings/transfer-tokens/${C.id}`,{transferToken:C}),se("transferTokens.success")),N({...C}),O({type:"success",message:D(P?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),F.current(P?"didCreateToken":"didEditToken",{type:v?.permissions,tokenType:z.f})}catch(C){const pe=(0,m.Iz)(C.response.data);V.setErrors(pe),C?.response?.data?.error?.message===te?O({type:"warning",message:C.response.data.message||"notification.error.tokennamenotunique"}):C?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:C?.response?.data?.message||"notification.error"}),W()}},b=re&&!P||ae&&P;if(!P&&!v&&ce!=="success")return t.createElement(x,{transferTokenName:v?.name});const ge=g=>{g?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?O({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):O({type:"warning",message:_(g)})};return t.createElement(i.o,null,t.createElement(a.SL,{name:"Transfer Tokens"}),t.createElement(n.J9,{validationSchema:f,validateOnChange:!1,initialValues:{name:v?.name||"",description:v?.description||"",lifespan:v?.lifespan?v.lifespan.toString():v?.lifespan,permissions:v?.permissions.join("-")},enableReinitialize:!0,onSubmit:(g,V)=>ue(g,V)},({errors:g,handleChange:V,isSubmitting:X,values:H})=>t.createElement(a.l0,null,t.createElement(ee.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:v,setToken:N,canEditInputs:b,canRegenerate:ie,isSubmitting:X,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:ge}),t.createElement(c.D,null,t.createElement(d.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(v?.name)&&t.createElement(w.Z,{token:v?.accessKey,tokenType:z.f}),t.createElement(q,{errors:g,onChange:V,canEditInputs:b,isCreating:P,values:H,transferToken:v}))))))}}}]);
